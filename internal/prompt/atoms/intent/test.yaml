# Test Intent Verb Atoms
# Test generation, coverage strategies, test categories

- id: "intent/test/core"
  category: "intent"
  subcategory: "test"
  priority: 95
  is_mandatory: true
  intent_verbs: ["/test"]
  content: |
    ## TEST INTENT PROTOCOL (Encyclopedic)

    Your intent is to **TEST** — verify behavior through automated checks that prevent regression and encode the system’s invariants.

    ### Prime Directive
    Tests are executable truth. If a behavior matters, a test should constrain it.

    ### Encyclopedic Test Workflow
    1. **Pin behavior**
       - Identify the observable contract (inputs → outputs → side effects).
    2. **Enumerate cases**
       - Happy path, boundaries, invalid inputs, error propagation, concurrency.
    3. **Choose scope**
       - Unit for pure logic.
       - Integration when wiring crosses layers.
       - E2E for user‑visible flows.
    4. **Write table‑driven tests**
       - Keep cases explicit and names descriptive.
    5. **Validate test meaning**
       - Ensure the test fails for the right reason before fixing.
    6. **Run and interpret**
       - Prefer root‑cause fixes; avoid updating tests to “make green” without justification.

    ### Naming & Structure
    - Tests should read like specs: `TestThing_WhenCondition_ThenOutcome`.
    - Group by behavior, not by function size.
    - Put fixtures and helpers in the smallest scope possible.

- id: "intent/test/categories"
  category: "intent"
  subcategory: "test"
  priority: 90
  is_mandatory: false
  intent_verbs: ["/test"]
  depends_on: ["intent/test/core"]
  content: |
    ## TEST CATEGORIES

    ### UNIT TESTS
    - Test single function/method in isolation
    - Mock all dependencies
    - Fast (<100ms)
    - Location: `*_test.go` next to source

    ### INTEGRATION TESTS
    - Test interaction between components
    - May use real databases (testcontainers)
    - Medium speed (1-10s)
    - Location: `*_integration_test.go` or `/test/integration/`

    ### END-TO-END TESTS
    - Test full user flows
    - Real services, real data
    - Slow (10s-1min)
    - Location: `/test/e2e/`

    ### PROPERTY-BASED TESTS
    - Generate random inputs
    - Verify properties hold for all inputs
    - Use rapid/gopter
    ```go
    rapid.Check(t, func(t *rapid.T) {
        input := rapid.String().Draw(t, "input")
        result := Reverse(Reverse(input))
        assert.Equal(t, input, result)
    })
    ```

- id: "intent/test/coverage"
  category: "intent"
  subcategory: "test"
  priority: 85
  is_mandatory: false
  intent_verbs: ["/test"]
  content: |
    ## COVERAGE STRATEGIES

    ### COVERAGE TARGETS
    - **Critical Paths**: 100% (auth, payments, data)
    - **Business Logic**: 80%+
    - **Utilities**: 70%+
    - **Generated Code**: 0% (exclude from coverage)

    ### EDGE CASE CHECKLIST
    - [ ] Empty input
    - [ ] Nil/null input
    - [ ] Single element
    - [ ] Maximum size input
    - [ ] Invalid format
    - [ ] Boundary values (0, -1, MAX_INT)
    - [ ] Unicode/special characters
    - [ ] Concurrent access

    ### ERROR PATH TESTING
    ```go
    func TestCreateUser_DatabaseError_ReturnsError(t *testing.T) {
        repo := &mockRepo{err: errors.New("connection failed")}
        svc := NewUserService(repo)

        _, err := svc.CreateUser(ctx, input)

        assert.Error(t, err)
        assert.Contains(t, err.Error(), "connection failed")
    }
    ```

    ### COVERAGE COMMANDS
    ```bash
    go test -coverprofile=coverage.out ./...
    go tool cover -html=coverage.out
    go tool cover -func=coverage.out
    ```
