# Piggyback Protocol Exemplars
# Control packet output examples

- id: "exemplar/piggyback/basic"
  category: "exemplar"
  subcategory: "piggyback"
  priority: 95
  is_mandatory: false
  shard_types: ["/coder", "/tester", "/reviewer"]
  content: |
    ## PIGGYBACK OUTPUT EXEMPLAR - BASIC

    ### CODER OUTPUT
    ```json
    {
      "surface_response": "I've implemented the user validation function with email format checking and length constraints.",
      "control_packet": {
        "intent_classification": {
          "category": "/mutation",
          "verb": "/create",
          "target": "user_validation",
          "constraints": ["email_format", "length_limit"]
        },
        "mangle_updates": [
          "file_modified(\"/internal/user/validation.go\", 45)",
          "function_added(\"ValidateEmail\", \"/internal/user/validation.go\")",
          "test_needed(\"ValidateEmail\", \"unit\")"
        ],
        "reasoning_trace": "1. Analyzed existing User struct. 2. Identified validation needs. 3. Implemented regex-based email validation. 4. Added length checks per requirements.",
        "confidence": 0.9,
        "next_actions": ["/test", "/review"],
        "context_feedback": {
          "overall_usefulness": 0.85,
          "helpful_facts": ["file_topology", "symbol_graph", "project_context"],
          "noise_facts": ["browser_state"],
          "missing_context": ""
        }
      },
      "artifacts": [
        {
          "type": "file_edit",
          "path": "/internal/user/validation.go",
          "operation": "create",
          "content": "..."
        }
      ]
    }
    ```

- id: "exemplar/piggyback/review"
  category: "exemplar"
  subcategory: "piggyback"
  priority: 90
  is_mandatory: false
  shard_types: ["/reviewer"]
  content: |
    ## PIGGYBACK OUTPUT EXEMPLAR - REVIEWER

    ### REVIEW OUTPUT
    ```json
    {
      "surface_response": "Code review complete. Found 2 issues: one potential nil pointer dereference (high) and one style inconsistency (low).",
      "control_packet": {
        "intent_classification": {
          "category": "/verification",
          "verb": "/review",
          "target": "PR_123",
          "constraints": ["security", "correctness", "style"]
        },
        "findings": [
          {
            "severity": "high",
            "type": "potential_nil_deref",
            "file": "/internal/handler/user.go",
            "line": 45,
            "description": "user.Profile accessed without nil check",
            "suggestion": "Add nil check before accessing Profile"
          },
          {
            "severity": "low",
            "type": "style",
            "file": "/internal/handler/user.go",
            "line": 52,
            "description": "Inconsistent error message format",
            "suggestion": "Use lowercase error messages per Go conventions"
          }
        ],
        "mangle_updates": [
          "review_finding(\"potential_nil_deref\", \"/internal/handler/user.go\", 45, \"high\")",
          "review_finding(\"style\", \"/internal/handler/user.go\", 52, \"low\")"
        ],
        "verdict": "changes_requested",
        "confidence": 0.85,
        "context_feedback": {
          "overall_usefulness": 0.75,
          "helpful_facts": ["symbol_graph", "file_topology", "diagnostic_found"],
          "noise_facts": ["session_context", "campaign_context"],
          "missing_context": "git blame for recently changed lines"
        }
      }
    }
    ```

- id: "exemplar/piggyback/test"
  category: "exemplar"
  subcategory: "piggyback"
  priority: 85
  is_mandatory: false
  shard_types: ["/tester"]
  content: |
    ## PIGGYBACK OUTPUT EXEMPLAR - TESTER

    ### TEST OUTPUT
    ```json
    {
      "surface_response": "Generated 5 test cases for ValidateEmail: 3 passing cases, 2 edge cases for invalid input.",
      "control_packet": {
        "intent_classification": {
          "category": "/verification",
          "verb": "/test",
          "target": "ValidateEmail",
          "constraints": ["unit", "edge_cases", "error_paths"]
        },
        "test_plan": {
          "function": "ValidateEmail",
          "file": "/internal/user/validation_test.go",
          "cases": [
            {"name": "valid_email", "type": "happy_path"},
            {"name": "valid_email_with_plus", "type": "happy_path"},
            {"name": "valid_email_subdomain", "type": "happy_path"},
            {"name": "empty_string", "type": "error_case"},
            {"name": "missing_at_symbol", "type": "error_case"}
          ]
        },
        "mangle_updates": [
          "test_generated(\"ValidateEmail\", \"unit\", 5)",
          "coverage_target(\"ValidateEmail\", 0.90)"
        ],
        "reasoning_trace": "1. Identified function signature. 2. Analyzed RFC 5322 email format. 3. Generated valid cases. 4. Generated boundary cases. 5. Generated error cases.",
        "confidence": 0.95,
        "context_feedback": {
          "overall_usefulness": 0.9,
          "helpful_facts": ["test_state", "file_topology", "symbol_graph"],
          "noise_facts": ["browser_state", "dom_node"],
          "missing_context": ""
        }
      },
      "artifacts": [
        {
          "type": "file_edit",
          "path": "/internal/user/validation_test.go",
          "operation": "create",
          "content": "..."
        }
      ]
    }
    ```
