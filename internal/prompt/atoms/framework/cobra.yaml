# Cobra Framework Prompt Atoms
# CLI application development with spf13/cobra

- id: "framework/cobra/structure"
  category: "framework"
  subcategory: "cobra"
  priority: 65
  is_mandatory: false
  shard_types: ["/coder"]
  languages: ["/go"]
  frameworks: ["/cobra"]
  content: |
    ## Cobra CLI Structure

    ### Root Command
    ```go
    package cmd

    import (
        "github.com/spf13/cobra"
    )

    var rootCmd = &cobra.Command{
        Use:   "myapp",
        Short: "A brief description of your application",
        Long: `A longer description that spans multiple lines
    and likely contains examples and usage of using your application.`,
        Run: func(cmd *cobra.Command, args []string) {
            // Root command logic (usually prints help)
        },
    }

    func Execute() error {
        return rootCmd.Execute()
    }

    func init() {
        // Global flags
        rootCmd.PersistentFlags().BoolP("verbose", "v", false, "verbose output")

        // Local flags
        rootCmd.Flags().StringP("config", "c", "", "config file")
    }
    ```

    ### Project Layout
    ```
    cmd/
    ├── root.go      # Root command
    ├── serve.go     # serve subcommand
    ├── init.go      # init subcommand
    └── version.go   # version subcommand
    main.go          # Entry point: cmd.Execute()
    ```

- id: "framework/cobra/subcommands"
  category: "framework"
  subcategory: "cobra"
  priority: 60
  is_mandatory: false
  shard_types: ["/coder"]
  languages: ["/go"]
  frameworks: ["/cobra"]
  content: |
    ## Cobra Subcommands

    ### Creating Subcommands
    ```go
    // cmd/serve.go
    var serveCmd = &cobra.Command{
        Use:   "serve",
        Short: "Start the server",
        Long:  "Start the HTTP server with the configured settings.",
        RunE: func(cmd *cobra.Command, args []string) error {
            port, _ := cmd.Flags().GetInt("port")
            return startServer(port)
        },
    }

    func init() {
        rootCmd.AddCommand(serveCmd)
        serveCmd.Flags().IntP("port", "p", 8080, "port to listen on")
        serveCmd.Flags().StringP("host", "H", "localhost", "host to bind")
    }
    ```

    ### Nested Subcommands
    ```go
    // cmd/config/config.go
    var configCmd = &cobra.Command{
        Use:   "config",
        Short: "Manage configuration",
    }

    // cmd/config/get.go
    var configGetCmd = &cobra.Command{
        Use:   "get [key]",
        Short: "Get a config value",
        Args:  cobra.ExactArgs(1),
        RunE: func(cmd *cobra.Command, args []string) error {
            return getConfig(args[0])
        },
    }

    func init() {
        rootCmd.AddCommand(configCmd)
        configCmd.AddCommand(configGetCmd)
    }
    ```

- id: "framework/cobra/flags"
  category: "framework"
  subcategory: "cobra"
  priority: 60
  is_mandatory: false
  shard_types: ["/coder"]
  languages: ["/go"]
  frameworks: ["/cobra"]
  content: |
    ## Cobra Flags and Configuration

    ### Flag Types
    ```go
    // Persistent flags (inherited by subcommands)
    rootCmd.PersistentFlags().StringVar(&cfgFile, "config", "", "config file")

    // Local flags (only this command)
    cmd.Flags().IntP("count", "n", 10, "number of items")

    // Required flags
    cmd.Flags().StringP("name", "n", "", "name (required)")
    cmd.MarkFlagRequired("name")

    // Flag groups (mutually exclusive)
    cmd.MarkFlagsMutuallyExclusive("json", "yaml")
    ```

    ### Viper Integration
    ```go
    import "github.com/spf13/viper"

    func init() {
        cobra.OnInitialize(initConfig)
        rootCmd.PersistentFlags().StringVar(&cfgFile, "config", "", "config file")
        viper.BindPFlag("port", rootCmd.PersistentFlags().Lookup("port"))
    }

    func initConfig() {
        if cfgFile != "" {
            viper.SetConfigFile(cfgFile)
        } else {
            viper.SetConfigName("config")
            viper.AddConfigPath(".")
        }
        viper.AutomaticEnv()
        viper.ReadInConfig()
    }
    ```

- id: "framework/cobra/best_practices"
  category: "framework"
  subcategory: "cobra"
  priority: 55
  is_mandatory: false
  shard_types: ["/coder"]
  languages: ["/go"]
  frameworks: ["/cobra"]
  content: |
    ## Cobra Best Practices

    ### Argument Validation
    ```go
    var cmd = &cobra.Command{
        Use:   "process [file]",
        Args:  cobra.ExactArgs(1),        // Exactly 1 arg
        // Other options:
        // cobra.NoArgs           - No arguments
        // cobra.ArbitraryArgs    - Any number
        // cobra.MinimumNArgs(n)  - At least n
        // cobra.MaximumNArgs(n)  - At most n
        // cobra.RangeArgs(n, m)  - Between n and m
    }
    ```

    ### Use RunE for Errors
    ```go
    // Prefer RunE over Run for proper error handling
    var cmd = &cobra.Command{
        RunE: func(cmd *cobra.Command, args []string) error {
            if err := validate(args); err != nil {
                return fmt.Errorf("validation failed: %w", err)
            }
            return execute(args)
        },
    }
    ```

    ### Help Customization
    ```go
    cmd.SetHelpTemplate(`Custom help template...`)
    cmd.SetUsageTemplate(`Custom usage template...`)

    // Example output
    cmd.Example = `  myapp serve --port 8080
      myapp config get database.host`
    ```

    ### Pre/Post Hooks
    ```go
    var cmd = &cobra.Command{
        PreRunE: func(cmd *cobra.Command, args []string) error {
            return loadConfig()
        },
        PostRunE: func(cmd *cobra.Command, args []string) error {
            return cleanup()
        },
    }
    ```
