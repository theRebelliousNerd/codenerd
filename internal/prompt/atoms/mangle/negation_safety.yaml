# AUTOGENERATED FROM MARKDOWN: this file was converted from a .md atom doc
# Source: negation_safety.md

- id: "language/mangle/docs/negation_safety"
  category: "language"
  subcategory: "mangle"
  description: "Safe Negation in Mangle"
  priority: 30
  is_mandatory: false
  languages: ["/mangle"]
  content: |
    # Safe Negation in Mangle
    
    ## The Safety Rule
    
    ALL variables in a negated atom MUST be bound by a positive atom FIRST.
    
    ### Why This Matters
    Mangle uses bottom-up evaluation. Without a binding predicate, the engine cannot iterate over "all possible values" - that set is infinite.
    
    ### Incorrect (Unsafe)
    ```mangle
    # WRONG - X is unbound before negation
    non_admin(X) :- not admin(X).
    ```
    This will crash or produce incorrect results because `X` has no domain.
    
    ### Correct (Safe)
    ```mangle
    # CORRECT - X is bound by user() first
    non_admin(X) :- user(X), not admin(X).
    #               ^^^^^^^ Generator predicate binds X
    ```
    
    ## Common Patterns
    
    ### Pattern 1: Simple Exclusion
    ```mangle
    # Find users who are not blocked
    active_user(U) :- user(U), not blocked(U).
    ```
    
    ### Pattern 2: Multiple Negations
    ```mangle
    # Each negated variable must be bound
    clean_user(U) :-
        user(U),
        not blocked(U),
        not suspended(U),
        not deleted(U).
    ```
    
    ### Pattern 3: Conditional with Negation
    ```mangle
    # Check if a file exists but has no test
    untested_file(F) :-
        file_topology(F, _, _, _, /false),  # Binds F AND checks IsTestFile=/false
        not test_coverage(F).
    ```
    
    ## Checklist Before Using `not`
    
    1. Is every variable in the negated atom already bound?
    2. Is the binding from a POSITIVE atom (not another negation)?
    3. Is the binding BEFORE the negation in the rule body?
