# AUTOGENERATED FROM MARKDOWN: this file was converted from a .md atom doc
# Source: engine/evaluation_strategies.md

- id: "language/mangle/docs/engine/evaluation_strategies"
  category: "language"
  subcategory: "mangle"
  description: "Mangle Engine: Evaluation Strategies"
  priority: 30
  is_mandatory: false
  languages: ["/mangle"]
  content: |
    # Mangle Engine: Evaluation Strategies
    
    ## Semi-Naive Evaluation
    
    The Mangle engine implements the **semi-naive evaluation strategy** for Datalog programs. This is the core algorithm that computes the fixpoint of the consequence operator.
    
    ### How It Works
    
    1. **Incremental Application**: Applies rules to known facts incrementally
    2. **Deduplication**: Takes care of consequences of already-seen facts only once
    3. **Fixpoint Termination**: Continues until no new facts are discovered
    4. **Monotonic Growth**: Can only add facts, never remove them
    
    ### Key Principle
    
    The knowledge base grows monotonically - each evaluation round produces a **superset** of previous results. This simple model provides great simplicity: users don't need to worry about the structure of source data.
    
    ## Evaluation Process
    
    ```
    Base Facts → Apply Rules → Derive New Facts → Check for Fixpoint
        ↑                                              ↓
        └──────────── No New Facts ←──────────────────┘
    ```
    
    ### Three Components
    
    1. **Base facts** - Initial extensional relations provided as input
    2. **Rules** - Logical instructions that derive new facts
    3. **Derived facts** - Intensional relations generated through evaluation
    
    ### Termination Guarantee
    
    Pure Datalog provides **guaranteed termination**. However, Mangle's extensions (aggregation, function calls, structured data) can potentially break this guarantee.
    
    **Important**: When using extensions, termination is NOT guaranteed. Use fact limits to prevent infinite loops.
    
    ## Stratified Evaluation
    
    For programs with negation, Mangle uses **stratified evaluation**:
    
    1. **Layer Separation**: Divides predicates into strata (layers)
    2. **Sequential Composition**: Each stratum treats previous strata as extensional
    3. **Independent Evaluation**: Each layer is evaluated to fixpoint independently
    4. **Topological Order**: Strata are sorted so dependencies are respected
    
    ### Stratification Constraint
    
    **Critical Rule**: Negation CANNOT be part of predicate definitions that recursively depend on each other.
    
    This enables "semipositive datalog programs" (negation applies only to extensional relations) to be safely composed sequentially.
    
    ## Top-Down Evaluation
    
    For individual premises, Mangle also supports top-down evaluation via `EvalPremise`:
    
    - Similar to PROLOG-style SLD resolution
    - Even though negated atoms exist, they are treated as lookups
    - Uses stratified semantics for safety
    
    ## Performance Considerations
    
    The documentation notes: "Implementing such a simple model may not be simple at all" when handling:
    
    - Distributed data
    - Slow rule evaluation
    - Large fact stores
    
    Quality implementations maintain the simple logical appearance while optimizing computation underneath.
    
    ## Key Engine Functions
    
    ### EvalProgram
    Evaluates a given program on the given facts, modifying the fact store in the process.
    
    ### EvalProgramWithStats
    Same as EvalProgram but returns statistics about the evaluation.
    
    ### EvalStratifiedProgramWithStats
    Evaluates a stratified program (with negation) on the given facts.
    
    ### EvalPremise
    Evaluates a single premise top-down using PROLOG-style SLD resolution.
    
    ## Evaluation Options
    
    Use `EvalOption` to configure evaluation behavior:
    
    - `WithCreatedFactLimit(n)` - Limits maximum facts created during evaluation
    - Future options may control memory limits, timeout, etc.
