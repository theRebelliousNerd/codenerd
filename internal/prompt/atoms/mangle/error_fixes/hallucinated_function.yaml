# AUTOGENERATED FROM MARKDOWN: this file was converted from a .md atom doc
# Source: error_fixes/hallucinated_function.md

- id: "language/mangle/docs/error_fixes/hallucinated_function"
  category: "language"
  subcategory: "mangle"
  description: "Fix: Hallucinated Function"
  priority: 30
  is_mandatory: false
  languages: ["/mangle"]
  content: |
    # Fix: Hallucinated Function
    
    ## Error Pattern
    ```
    unbound predicate
    undefined function
    unknown builtin
    ```
    
    ## Cause
    LLMs often hallucinate functions that don't exist in Mangle's standard library.
    
    ## Common Hallucinations
    
    ### String Functions (Mostly Don't Exist)
    
    | Hallucinated | Status | Alternative |
    |-------------|--------|-------------|
    | `fn:split(S, ",")` | DOES NOT EXIST | Parse before loading facts |
    | `fn:substring(S, 0, 5)` | DOES NOT EXIST | Parse before loading facts |
    | `fn:length(S)` | DOES NOT EXIST | Compute in Go |
    | `fn:replace(S, A, B)` | DOES NOT EXIST | Transform in Go |
    | `fn:lower(S)` | DOES NOT EXIST | Normalize before loading |
    | `fn:upper(S)` | DOES NOT EXIST | Normalize before loading |
    | `fn:trim(S)` | DOES NOT EXIST | Normalize before loading |
    | `fn:concat(A, B)` | EXISTS | `fn:string_concat(A, B)` |
    
    ### Collection Functions
    
    | Hallucinated | Status | Alternative |
    |-------------|--------|-------------|
    | `fn:in(X, List)` | DOES NOT EXIST | Use `:match_cons` |
    | `fn:len(List)` | DOES NOT EXIST | Compute in Go |
    | `fn:filter(List, Pred)` | DOES NOT EXIST | Use rule conditions |
    | `fn:map(List, Fn)` | DOES NOT EXIST | Use rule derivation |
    
    ### Comparison Functions
    
    | Hallucinated | Status | Alternative |
    |-------------|--------|-------------|
    | `fn:contains(S, Sub)` | EXISTS | Works on strings |
    | `fn:startswith(S, P)` | EXISTS | Works on strings |
    | `fn:matches(S, Regex)` | DOES NOT EXIST | Check in Go |
    
    ## Available Built-in Functions
    
    ### Arithmetic
    ```mangle
    fn:plus(X, Y)      # Addition
    fn:minus(X, Y)     # Subtraction
    fn:mult(X, Y)      # Multiplication
    fn:div(X, Y)       # Division
    fn:mod(X, Y)       # Modulo
    ```
    
    ### String
    ```mangle
    fn:string_concat(A, B)  # Concatenate strings
    fn:contains(S, Sub)     # Check substring
    fn:startswith(S, Pre)   # Check prefix
    ```
    
    ### Aggregation (in transform blocks only)
    ```mangle
    fn:Count()         # Count rows
    fn:Sum(X)          # Sum values
    fn:Min(X)          # Minimum value
    fn:Max(X)          # Maximum value
    fn:group_by(K)     # Group by key
    ```
    
    ### List Operations
    ```mangle
    :match_cons(List, Head, Tail)  # Destructure list
    :match_nil(List)               # Check empty list
    fn:list:get(List, Index)       # Get by index
    fn:list:len(List)              # List length
    ```
    
    ## Fix Strategy
    
    1. **Check if function exists** in the builtin package
    2. **Move to Go** if it's string manipulation
    3. **Pre-compute** values before loading as facts
    4. **Use patterns** instead of functions where possible
    
    ### Example Fix
    
    **Before (Hallucinated):**
    ```mangle
    # WRONG - fn:split doesn't exist
    parts(Name, Part) :- data(Name, S), fn:split(S, ",", Part).
    ```
    
    **After (Pre-compute in Go):**
    ```mangle
    # Facts generated by Go code that split the string
    data_part(/record1, /part_a).
    data_part(/record1, /part_b).
    # Then use simple lookup
    parts(Name, Part) :- data_part(Name, Part).
    ```
