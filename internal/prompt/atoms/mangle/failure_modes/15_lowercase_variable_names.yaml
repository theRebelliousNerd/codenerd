# AUTOGENERATED FROM MARKDOWN: this file was converted from a .md atom doc
# Source: failure_modes/15_lowercase_variable_names.md

- id: "language/mangle/docs/failure_modes/15_lowercase_variable_names"
  category: "language"
  subcategory: "mangle"
  description: "Failure Mode 15: Lowercase Variable Names"
  priority: 30
  is_mandatory: false
  languages: ["/mangle"]
  content: |
    # Failure Mode 15: Lowercase Variable Names
    
    ## Category
    Syntactic Hallucination (Prolog Bias)
    
    ## Severity
    HIGH - Logic errors, unintended constants
    
    ## Error Pattern
    Using lowercase for variables (Prolog style) instead of UPPERCASE (Mangle requirement). Lowercase identifiers are treated as atoms/constants, not variables.
    
    ## Wrong Code
    ```mangle
    # WRONG - Prolog style (lowercase variables)
    ancestor(x, y) :- parent(x, y).
    
    # WRONG - Mixed case
    ancestor(X, y) :- parent(X, y).  # y is constant, not variable!
    
    # WRONG - Camel case variables
    ancestor(fromNode, toNode) :- edge(fromNode, toNode).
    
    # WRONG - Snake case variables
    ancestor(from_node, to_node) :- edge(from_node, to_node).
    
    # WRONG - In declarations
    Decl parent(x.Type<n>, y.Type<n>).  # x and y are constants!
    ```
    
    ## Correct Code
    ```mangle
    # CORRECT - UPPERCASE variables
    ancestor(X, Y) :- parent(X, Y).
    
    # CORRECT - All variables uppercase
    ancestor(X, Y) :- parent(X, Y).
    ancestor(X, Z) :- parent(X, Y), ancestor(Y, Z).
    
    # CORRECT - Descriptive uppercase names OK
    ancestor(FromNode, ToNode) :- edge(FromNode, ToNode).
    
    # CORRECT - Uppercase with underscores
    ancestor(From_Node, To_Node) :- edge(From_Node, To_Node).
    
    # CORRECT - In declarations
    Decl parent(X.Type<n>, Y.Type<n>).
    
    # CORRECT - Anonymous variable
    ancestor(X, _) :- parent(X, _).  # Underscore = don't care
    ```
    
    ## Detection
    - **Symptom**: Variables don't unify as expected
    - **Symptom**: Rules produce no results (lowercase treated as constant)
    - **Pattern**: Lowercase identifiers in rule bodies
    - **Test**: Variables should be UPPERCASE, constants lowercase or `/atom`
    
    ## What Happens
    ```mangle
    # This rule:
    ancestor(x, y) :- parent(x, y).
    
    # Is interpreted as:
    # "ancestor(x, y) is true if there exists parent(x, y)"
    # Where x and y are CONSTANTS (like /x and /y)
    # NOT variables!
    
    # So this only matches if you have:
    parent(x, y).  # Exact fact with constants x and y
    ```
    
    ## Prevention
    1. **ALL variables UPPERCASE** - No exceptions
    2. **Lowercase = constant** - Reserved for atoms
    3. **Use descriptive names** - `Ancestor`, `FromNode`, `UserID` all OK
    4. **Anonymous variable** - Use `_` when you don't care about value
    
    ## Variable Naming Rules
    | Pattern | Interpretation | Use For |
    |---------|----------------|---------|
    | `X`, `Y`, `Z` | Variable | Generic placeholders |
    | `Ancestor` | Variable | Descriptive single word |
    | `FromNode` | Variable | Descriptive camel case |
    | `From_Node` | Variable | Descriptive snake case |
    | `_` | Anonymous variable | Don't care values |
    | `x`, `y`, `z` | **CONSTANT** | ⚠️ NOT a variable! |
    | `fromNode` | **CONSTANT** | ⚠️ NOT a variable! |
    
    ## Correct Examples by Use Case
    
    ### Generic Variables
    ```mangle
    # Simple generic variables
    edge(X, Y).
    path(X, Y, Z).
    
    # Aggregation
    total(Sum) :- value(X) |> let Sum = fn:Sum(X).
    ```
    
    ### Descriptive Variables
    ```mangle
    # Better readability with descriptive names
    manages(Manager, Employee) :- reports_to(Employee, Manager).
    
    # File path example
    contains_file(Directory, Filename) :-
        file_path(Path),
        :match_field(Path, /dir, Directory),
        :match_field(Path, /name, Filename).
    ```
    
    ### Anonymous Variables
    ```mangle
    # Don't care about second argument
    has_parent(Child) :- parent(_, Child).
    
    # Don't care about tail of list
    first_element(Head) :- my_list(L), :match_cons(L, Head, _).
    
    # Discard intermediate values
    reachable(X, Y) :- edge(X, _), edge(_, Y).
    ```
    
    ## Complex Example: Pattern Matching Importance
    
    ```mangle
    # Schema
    Decl user(ID.Type<n>, Name.Type<string>, Age.Type<int>).
    
    # WRONG - lowercase treated as constants
    adult(id, name) :- user(id, name, age), age >= 18.
    # This tries to find user with ID=id, Name=name, Age=age
    # Where id, name, age are CONSTANTS, not variables!
    
    # CORRECT - uppercase variables
    adult(ID, Name) :- user(ID, Name, Age), Age >= 18.
    # This binds variables ID, Name, Age and filters Age >= 18
    ```
    
    ## Training Bias Origins
    | Language | Variable Style | Leads to Wrong Mangle |
    |----------|----------------|----------------------|
    | Prolog | Lowercase | `ancestor(x, y)` |
    | Python | Lowercase | `def func(x, y)` |
    | JavaScript | Camel case | `const fromNode` |
    | SQL | Uppercase (opposite!) | Confusion |
    
    ## Quick Check
    For every identifier in a rule:
    1. Is it a variable (unknown value)? → UPPERCASE
    2. Is it a constant (specific value)? → lowercase or `/atom`
    3. Is it an anonymous placeholder? → `_`
    
    ## Common Mistakes
    
    | Wrong | Interpretation | Correct |
    |-------|----------------|---------|
    | `edge(x, y)` | Constants x and y | `edge(X, Y)` |
    | `path(From, to)` | Variable From, constant to | `path(From, To)` |
    | `sum(total)` | Constant total | `sum(Total)` |
    | `list([head\|tail])` | Invalid syntax | `list(L), :match_cons(L, Head, Tail)` |
    
    ## Debugging Aid
    ```mangle
    # If rules aren't matching, check variable casing:
    
    # This won't work (lowercase = constants):
    # test(x) :- data(x).
    
    # Add debug rule to see what's happening:
    debug_data(X) :- data(X).
    
    # Query: ?debug_data(X)
    # If this returns results but your lowercase version doesn't,
    # you have a variable casing issue!
    ```
