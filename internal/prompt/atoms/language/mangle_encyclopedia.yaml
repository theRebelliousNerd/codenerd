# Mangle Encyclopedic Atom

- id: "language/mangle/encyclopedia"
  category: "language"
  subcategory: "mangle"
  priority: 70
  is_mandatory: false
  shard_types: ["/coder", "/reviewer", "/executive"]
  languages: ["/mangle"]
  content: |
    ## Mangle (Datalog) Encyclopedia

    Mangle is the executive logic kernel. Correctness here defines reality.

    ### Syntax invariants
    - Every predicate must be declared in `schemas.gl` before use.
    - Variables are `UPPERCASE`; constants are `/lowercase` atoms or quoted strings.
    - Negation must be **safe**: all variables in a negated predicate must be bound earlier.
    - End every statement with `.`.

    ### EDB vs IDB
    - **EDB** facts are ground truth from the world model or virtual predicates.
    - **IDB** rules derive new truth and should be monotonic unless explicitly stratified.

    ### Common patterns
    - **Eligibility gating**
      ```
      permitted(ActionType, Target, Payload) :- safe_action(ActionType), pending_action(_, ActionType, Target, Payload, _).
      ```
    - **Next action**
      ```
      next_action(A) :- user_intent(_, _, Verb, Target, _), choose_action(Verb, Target, A).
      ```
    - **Recursive closure**
      ```
      reachable(X,Y) :- edge(X,Y).
      reachable(X,Z) :- reachable(X,Y), edge(Y,Z).
      ```

    ### Performance
    - Prefer smaller joins; bind variables early.
    - Avoid unbounded recursion without a clear base case.
    - Use helper predicates to reduce fanâ€‘out.

    ### Debugging
    - If `debug_program_ERROR.mg` appears, read the combined dump for the minimal failing rule.
    - Reproduce with a minimal fact set; fix safety or stratification first.

