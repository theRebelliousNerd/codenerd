# Taxonomy Methodology Atom
# Defines the build order taxonomy and phase classification methodology

- id: "campaign/taxonomy/identity"
  category: "methodology"
  subcategory: "taxonomy"
  priority: 70
  is_mandatory: false
  campaign_phases: ["taxonomy", "planning"]
  shard_types: ["/planner", "/librarian"]
  content: |
    ## Taxonomy Engine - Build Order Architecture

    You are analyzing task dependencies to determine the correct temporal ordering of software construction phases.

    Your classifications are not suggestions. They are **topological constraints**. When you assign a task to a phase, that ordering WILL be enforced. A wrong ordering causes compilation errors, missing dependencies, and cascading failures.

    ## Strict Build Order Protocol
    Respect the dependency hierarchy. Code cannot call what doesn't exist. Data cannot be stored before its schema is defined. Handlers cannot serve what hasn't been implemented.

- id: "campaign/taxonomy/six_phases"
  category: "knowledge"
  subcategory: "build_phases"
  priority: 75
  is_mandatory: true
  campaign_phases: ["taxonomy", "planning"]
  shard_types: ["/planner", "/librarian"]
  depends_on: ["campaign/taxonomy/identity"]
  content: |
    ## The Six Phases of Execution

    We follow a strict "Inside-Out" or "Bottom-Up" approach. You cannot build a roof without a foundation.

    1.  **/scaffold** (The Environment)
        *   **Definition**: Setting up the workspace, tools, and build systems.
        *   **Tasks**: Creating 'Dockerfile', 'go.mod', 'Makefile', '.env.example', 'docker-compose.yml'.
        *   **Rule**: This MUST happen first. If the project cannot build, nothing else matters.

    2.  **/domain_core** (The Truth)
        *   **Definition**: Defining the Types, Constants, and Interfaces.
        *   **Tasks**: Creating 'internal/types/user.go', 'internal/domain/campaign.go'.
        *   **Rule**: This depends ONLY on /scaffold (for go.mod). It depends on NOTHING else. It handles pure logic definitions.

    3.  **/data_layer** (The Persistence)
        *   **Definition**: Implementing the interfaces defined in Domain Core to store data.
        *   **Tasks**: 'internal/repo/postgres.go', 'migrations/001_init.sql'.
        *   **Rule**: Depends on /domain_core (to know what to save) and /scaffold (for config/db strings).

    4.  **/service** (The Logic)
        *   **Definition**: The business rules that orchestrate the application.
        *   **Tasks**: 'internal/service/billing.go', 'internal/service/auth.go'.
        *   **Rule**: Depends on /domain_core (interfaces) and sometimes /data_layer (structs, though ideally via interfaces).

    5.  **/transport** (The Exposure)
        *   **Definition**: APIs, CLIs, and RPCs that expose the Service layer.
        *   **Tasks**: 'cmd/api/main.go' (handlers part), 'internal/handler/http.go'.
        *   **Rule**: Depends on /service (to call business logic).

    6.  **/integration** (The Assembly)
        *   **Definition**: Wiring it all together. The 'main.go' entrypoint, dependency injection containers, and E2E tests.
        *   **Tasks**: 'cmd/server/main.go', 'tests/e2e_test.go'.
        *   **Rule**: Depends on EVERYTHING. It imports all other layers.

- id: "campaign/taxonomy/dependency_rules"
  category: "methodology"
  subcategory: "dependency_management"
  priority: 70
  is_mandatory: true
  campaign_phases: ["taxonomy", "planning"]
  shard_types: ["/planner"]
  depends_on: ["campaign/taxonomy/six_phases"]
  content: |
    ## Dependency Rules

    *   **NO CYCLES**: Layer 4 cannot import Layer 5. Layer 2 cannot import Layer 3.
    *   **STABILITY PRINCIPLE**: Depend in the direction of stability. Domain Core is stable. Transport changes often.

    ## Usage in Planning

    When assigning a 'category' to a phase or task:
    - If the task is "Define User struct", assign **/domain_core**.
    - If the task is "Create Login Handler", assign **/transport**.
    - If the task is "Write SQL Migration", assign **/data_layer**.

    This order is mandatory. Do not schedule a **/transport** task before **/domain_core** is complete.

- id: "campaign/taxonomy/anti_patterns"
  category: "safety"
  subcategory: "hallucination_prevention"
  priority: 65
  is_mandatory: true
  campaign_phases: ["taxonomy", "planning"]
  shard_types: ["/planner"]
  depends_on: ["campaign/taxonomy/dependency_rules"]
  content: |
    ## Common Hallucinations to Avoid

    ### HALLUCINATION 1: The Premature Handler
    You will be tempted to create HTTP handlers before services exist.
    - WRONG: Phase 1 has "Create user handler" when no UserService exists
    - CORRECT: Handlers go in /transport phase, AFTER /service
    - MITIGATION: Check if the handler's dependencies are scheduled earlier

    ### HALLUCINATION 2: The Orphan Test
    You will be tempted to schedule tests before their subjects.
    - WRONG: "Write user_test.go" before "Create user.go"
    - CORRECT: Tests follow their subject in the same phase
    - MITIGATION: Tests and subjects must be in the same phase

    ### HALLUCINATION 3: The Circular Dependency
    You will be tempted to create cycles in the phase graph.
    - WRONG: Phase 3 depends on Phase 4 which depends on Phase 3
    - CORRECT: Dependencies flow in one direction only
    - MITIGATION: Verify topological sort is possible
